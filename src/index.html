<!doctype html>
<html>
  <head>
    <title><%= json.project.title %></title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" type="text/css" href="style.css">
    <%= t.include("partials/_head.html") %>
  </head>
  <body>


      <% 
      var people = json.OlympiansTracker_people;

      var events = {};      
      json.OlympiansTracker_events.forEach(function(item) {
        events[item.eventid] = item;
      });      

      people.forEach(function(person) {
        //This object holds each athlete with all of their events.
        person.days = {};

        json.OlympiansTracker_participation.forEach(function(item) {
          if (item.athleteid == person.athleteid) {
            var event = events[item.eventid];

            if (!person.days[event.date]) {
              person.days[event.date] = [];
            }
            person.days[event.date].push({
              participation: item,
              event: event,
              person: person.firstname
            });
          }
        });
      });

      %>
      <div class="container">
        <div class="athlete-box" "flex-item">
                </div>
        <div class="table-box" "flex-item">
        
            <table>
              <tr>
                <th>Name</th>
                <th>8/3</th>
                <th>8/4</th>
                <th>8/5</th>
                <th>8/6</th>
                <th>8/7</th>
                <th>8/8</th>
                <th>8/9</th>
                <th>8/10</th>
                <th>8/11</th>
                <th>8/12</th>
                <th>8/13</th>
                <th>8/14</th>
                <th>8/15</th>
                <th>8/16</th>
                <th>8/17</th>    
                <th>8/18</th>
                <th>8/19</th>
                <th>8/20</th>
                <th>8/21</th>
                <th>8/22</th>
                <th>8/23</th>
                <th>8/24</th>
              </tr>
        
          <% people.forEach(function(person) {   %>

            <tr class="athlete-row">
              <td class="athlete-name" data-id="<%= person.athleteid%>">
                <%=person.firstname%> <%=person.lastname%>
              </td>

            <% for (var i = 3; i < 25; i++) {
                var dateString = "8/" + i + "/16"; 
                var hasEvent = !!person.days[dateString]; 
                var eventDay = "event " + dateString;
                                %>
              <td class="<%= hasEvent ? eventDay : "no-event" %>">
                
              <% if (hasEvent) {  
               
               person.days[dateString].forEach( function(day) { %>
                <img src="./assets/<%= day.event.category%>.png">                                   
               <% });
                  
              } else { } %>

              </td> <!--td (per athlete): event/no-event-->

              <% }; %> 
          </tr> <!--tr: athlete row-->

          <% }); %>


        </table>  
       </div>

      <script> 
      window.olympians = <%= JSON.stringify(people) %>  
       
        </script>
    <script src="app.js" async></script>
    <% if (json.project.production) { %>
    <%= !json.project.embedded ? t.include("partials/_foot.html") : "" %>
    <%= t.include("partials/_workHere.html") %>
    <% } %>
  </body>
</html>
