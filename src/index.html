<!doctype html>
<html>
  <head>
    <title><%= json.project.title %></title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" type="text/css" href="style.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

    <%= t.include("partials/_head.html") %>
  </head>
  <body>

    <% 
    var people = json.OlympiansTracker_people;
    var events = {};  
    var participation = json.OlympiansTracker_participation;
    json.OlympiansTracker_events.forEach(function(item) {
      events[item.eventid] = item;
    });      

    people.forEach(function(person) {

      //This object holds each athlete with all of their events.
      person.days = {};

      participation.forEach(function(item) {
        if (item.athleteid == person.athleteid) {

          var event = events[item.eventid];
          if (!person.days[event.date]) {
            person.days[event.date] = [];
          }

          person.days[event.date].push({
            participation: item,
            event: event,
            person: person.firstname
          });
        }
      });
    }); %>

    <div class="container">

      <div class="table">

        <!--Headers-->
        <div class="table-column dates">
          <div class="row-item athlete-name">Name</div>
          <div class="row-item" data-id="8/3/16">8/3</div>
          <div class="row-item" data-id="8/4/16">8/4</div>
          <div class="row-item" data-id="8/5/16">8/5</div>
          <div class="row-item" data-id="8/6/16">8/6</div>
          <div class="row-item" data-id="8/7/16">8/7</div>
          <div class="row-item" data-id="8/8/16">8/8</div>
          <div class="row-item" data-id="8/9/16">8/9</div>
          <div class="row-item" data-id="8/10/16">8/10</div>
          <div class="row-item" data-id="8/11/16">8/11</div>
          <div class="row-item" data-id="8/12/16">8/12</div>
          <div class="row-item" data-id="8/13/16">8/13</div>
          <div class="row-item" data-id="8/14/16">8/14</div>
          <div class="row-item" data-id="8/15/16">8/15</div>
          <div class="row-item" data-id="8/16/16">8/16</div>
          <div class="row-item" data-id="8/17/16">8/17</div>    
          <div class="row-item" data-id="8/18/16">8/18</div>
          <div class="row-item" data-id="8/19/16">8/19</div>
          <div class="row-item" data-id="8/20/16">8/20</div>
          <div class="row-item" data-id="8/21/16">8/21</div>

        </div>
        
        <% 
        for (var j = 0; j < people.length; j++) {
            var athlete = people[j];
     
        
        <!--        Athlete Row-->
        if (j < 10) { %>
          <div class="table-column athleterows">

        <% }
          else { %>
            
          
        <div class="table-column athleterows off">
          <% } %>
          <div class="athlete-name row-item" data-id="<%= athlete.athleteid%>">
            <p class="name">
              <%=athlete.firstname%> <%=athlete.lastname%> <i class="fa fa-plus"></i>
            </p>
          </div>
          
          <div class="athlete-box mobile" data-id="<%= athlete.athleteid%>"></div>
          
        <!--Event rows-->
          <% for (var i = 3; i < 22; i++) {
            
            var dateString = "8/" + i + "/16"; 
            var hasEvent = !!athlete.days[dateString]; 
            var eventDay = "event " + dateString;
            %>
          <div class="row-item <%= hasEvent ? eventDay : "noevent" %>" data-id="<%= dateString%> ">
            <% if (hasEvent) {  
              
              athlete.days[dateString].forEach( function(day) { %>

                <div class="tooltip">
                  <i class="icon">
                    <img src="assets/Icons/<%=athlete.icon_name%>.png">
                  </i>


                  <span class="tooltiptext">    

                    <%=athlete.sport%><br>
                    <%=day.event.title%><br>
                    Local Time: <%=day.event.localtime%><br>
                    Rio Time: <%=day.event.riotime%><br>
                  </span>
                </div>
            
              <% });

            } %>

          </div>
        <% }; %> 
        </div> 
        <div class="athlete-box" data-id="<%= athlete.athleteid%>"></div>
<% } %>



      </div>
        <p class=expand>Expand</p>
      <script> 
        window.olympians = <%= JSON.stringify(people) %>  
      </script>
      <script src="app.js" async></script>
      <% if (json.project.production) { %>
      <%= !json.project.embedded ? t.include("partials/_foot.html") : "" %>
      <%= t.include("partials/_workHere.html") %>
      <% } %>
      </body>
    </html>
